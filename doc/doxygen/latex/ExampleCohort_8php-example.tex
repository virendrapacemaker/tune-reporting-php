\hypertarget{ExampleCohort_8php-example}{\section{Example\-Cohort.\-php}
}

\begin{DoxyCodeInclude}
<?php\textcolor{comment}{}
\textcolor{comment}{/**}
\textcolor{comment}{ * ExampleCohort.php}
\textcolor{comment}{ * }
\textcolor{comment}{ * Copyright (c) 2014 Tune, Inc}
\textcolor{comment}{ * All rights reserved.}
\textcolor{comment}{ *}
\textcolor{comment}{ * Permission is hereby granted, free of charge, to any person obtaining a copy}
\textcolor{comment}{ * of this software and associated documentation files (the "Software"), to deal}
\textcolor{comment}{ * in the Software without restriction, including without limitation the rights}
\textcolor{comment}{ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}
\textcolor{comment}{ * copies of the Software, and to permit persons to whom the Software is}
\textcolor{comment}{ * furnished to do so, subject to the following conditions:}
\textcolor{comment}{ *}
\textcolor{comment}{ * The above copyright notice and this permission notice shall be included in}
\textcolor{comment}{ * all copies or substantial portions of the Software.}
\textcolor{comment}{ *}
\textcolor{comment}{ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR}
\textcolor{comment}{ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,}
\textcolor{comment}{ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE}
\textcolor{comment}{ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER}
\textcolor{comment}{ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,}
\textcolor{comment}{ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN}
\textcolor{comment}{ * THE SOFTWARE.}
\textcolor{comment}{ *}
\textcolor{comment}{ * PHP Version 5.3}
\textcolor{comment}{ *}
\textcolor{comment}{ * @category  Tune}
\textcolor{comment}{ * @package   Tune\_PHP\_SDK}
\textcolor{comment}{ * @author    Jeff Tanner <jefft@tune.com>}
\textcolor{comment}{ * @copyright 2014 Tune (http://www.tune.com)}
\textcolor{comment}{ * @license   http://opensource.org/licenses/MIT The MIT License (MIT)}
\textcolor{comment}{ * @version   0.9.1}
\textcolor{comment}{ * @link      https://developers.mobileapptracking.com Tune Developer Community @endlink}
\textcolor{comment}{ *}
\textcolor{comment}{ */}

\textcolor{keyword}{namespace }Tune\(\backslash\)Examples\(\backslash\)Management\(\backslash\)Api\(\backslash\)Advertiser\(\backslash\)Reports;

use \(\backslash\)Tune\(\backslash\)Management\(\backslash\)Api\(\backslash\)Advertiser\(\backslash\)Stats\(\backslash\)LTV;
\textcolor{comment}{}
\textcolor{comment}{/**}
\textcolor{comment}{ * Class ExampleCohort}
\textcolor{comment}{ *}
\textcolor{comment}{ * @package Tune\(\backslash\)Examples\(\backslash\)Management\(\backslash\)Api\(\backslash\)Advertiser\(\backslash\)Reports}
\textcolor{comment}{ */}
\textcolor{keyword}{class }ExampleCohort
\{\textcolor{comment}{}
\textcolor{comment}{    /**}
\textcolor{comment}{     * Constructor that prevents a default instance of this class from being created.}
\textcolor{comment}{     */}
    \textcolor{keyword}{private} \textcolor{keyword}{function} \_\_construct()
    \{

    \}
\textcolor{comment}{}
\textcolor{comment}{    /**}
\textcolor{comment}{     * @param string $api\_key MobileAppTracking API Key}
\textcolor{comment}{     *}
\textcolor{comment}{     * @throws \(\backslash\)InvalidArgumentException}
\textcolor{comment}{     * @throws \(\backslash\)Exception}
\textcolor{comment}{     */}
    \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keyword}{function} run($api\_key)
    \{
        \textcolor{comment}{// api\_key}
        \textcolor{keywordflow}{if} (!is\_string($api\_key) || empty($api\_key)) \{
            \textcolor{keywordflow}{throw} new \(\backslash\)InvalidArgumentException(\textcolor{stringliteral}{"Parameter 'api\_key' is not defined."});
        \}

        echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
        echo \textcolor{stringliteral}{"= Tune Management API Advertiser Reports Cohort      ="} . PHP\_EOL;
        echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;

        \textcolor{keywordflow}{try} \{
            date\_default\_timezone\_set(\textcolor{stringliteral}{'UTC'});

            $week\_ago       = date(\textcolor{stringliteral}{'Y-m-d'}, strtotime(\textcolor{stringliteral}{"-8 days"}));
            $yesterday      = date(\textcolor{stringliteral}{'Y-m-d'}, strtotime(\textcolor{stringliteral}{"-1 days"}));
            $start\_date     = \textcolor{stringliteral}{"\{$week\_ago\} 00:00:00"};
            $end\_date       = \textcolor{stringliteral}{"\{$yesterday\} 23:59:59"};

            $ltv = \textcolor{keyword}{new} LTV($api\_key, $validate = \textcolor{keyword}{true});

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
            echo \textcolor{stringliteral}{"= advertiser/stats all fields ="} . PHP\_EOL;
            $response = $ltv->getFields();
            echo print\_r($response, \textcolor{keyword}{true}) . PHP\_EOL;

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/count.json request ="} . PHP\_EOL;
            $response = $ltv->count(
                $start\_date,
                $end\_date,
                $cohort\_type         = \textcolor{stringliteral}{"click"},
                $group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
                $interval            = \textcolor{stringliteral}{"year\_day"},
                $filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
                $response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
            );

            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/count.json response:"} . PHP\_EOL;
            echo print\_r($response, \textcolor{keyword}{true}) . PHP\_EOL;

            \textcolor{keywordflow}{if} ($response->getHttpCode() != 200) \{
                \textcolor{keywordflow}{throw} new \(\backslash\)Exception(
                    sprintf(\textcolor{stringliteral}{"Failed: %d: %s"}, $response->getHttpCode(), print\_r($response->getErrors()))
                );
            \}
            echo \textcolor{stringliteral}{"= Count:"} . $response->getData() . PHP\_EOL;

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/find.json request csv ="} . PHP\_EOL;
            $response = $ltv->find(
                $start\_date,
                $end\_date,
                $cohort\_type         = \textcolor{stringliteral}{"click"},
                $aggregation\_type    = \textcolor{stringliteral}{"cumulative"},
                $group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
                $interval            = \textcolor{stringliteral}{"year\_day"},
                $filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
                $fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"}
                . \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"}
                . \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"}
                . \textcolor{stringliteral}{",opi,currency\_code"},
                $limit               = 5,
                $page                = null,
                $sort                = null,
                $format              = \textcolor{stringliteral}{"csv"},
                $response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
            );

            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/find.json response:"} . PHP\_EOL;
            echo print\_r($response, \textcolor{keyword}{true}) . PHP\_EOL;

            \textcolor{keywordflow}{if} ($response->getHttpCode() != 200) \{
                \textcolor{keywordflow}{throw} new \(\backslash\)Exception(
                    sprintf(\textcolor{stringliteral}{"Failed: %d: %s"}, $response->getHttpCode(), print\_r($response->getErrors()))
                );
            \}

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/find.json request json ="} . PHP\_EOL;
            $response = $ltv->find(
                $start\_date,
                $end\_date,
                $cohort\_type         = \textcolor{stringliteral}{"click"},
                $aggregation\_type    = \textcolor{stringliteral}{"cumulative"},
                $group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
                $interval            = \textcolor{stringliteral}{"year\_day"},
                $filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
                $fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"}
                . \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"}
                . \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"}
                . \textcolor{stringliteral}{",opi,currency\_code"},
                $limit               = 5,
                $page                = null,
                $sort                = null,
                $format              = \textcolor{stringliteral}{"json"},
                $response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
            );

            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/find.json response:"} . PHP\_EOL;
            echo print\_r($response, \textcolor{keyword}{true}) . PHP\_EOL;

            \textcolor{keywordflow}{if} ($response->getHttpCode() != 200) \{
                \textcolor{keywordflow}{throw} new \(\backslash\)Exception(
                    sprintf(\textcolor{stringliteral}{"Failed: %d: %s"}, $response->getHttpCode(), print\_r($response->getErrors()))
                );
            \}

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/export.json request           ="} . PHP\_EOL;

            $response = $ltv->export(
                $start\_date,
                $end\_date,
                $cohort\_type         = \textcolor{stringliteral}{"click"},
                $aggregation\_type    = \textcolor{stringliteral}{"cumulative"},
                $group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
                $interval            = \textcolor{stringliteral}{"year\_day"},
                $filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
                $fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"}
                . \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"}
                . \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"}
                . \textcolor{stringliteral}{",opi,currency\_code"},
                $response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
            );

            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/export.json response:"} . PHP\_EOL;
            echo print\_r($response, \textcolor{keyword}{true}) . PHP\_EOL;

            \textcolor{keywordflow}{if} ($response->getHttpCode() != 200) \{
                \textcolor{keywordflow}{throw} new \(\backslash\)Exception(
                    sprintf(\textcolor{stringliteral}{"Failed: %d: %s"}, $response->getHttpCode(), print\_r($response->getErrors()))
                );
            \}
            echo \textcolor{stringliteral}{"= Job ID: "} . print\_r($response->getData(), \textcolor{keyword}{true}) . PHP\_EOL;

            $job\_id = $response->getData()[\textcolor{stringliteral}{"job\_id"}];

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;
            echo \textcolor{stringliteral}{"= advertiser/stats/ltv/status.json request           ="} . PHP\_EOL;

            $csv\_report\_reader = $ltv->fetch(
                $job\_id,
                $report\_format = \textcolor{stringliteral}{"csv"},
                $verbose = \textcolor{keyword}{true},
                $sleep = 10
            );

            $csv\_report\_reader->read();
            $csv\_report\_reader->prettyPrint($limit = 5);

            echo \textcolor{stringliteral}{"======================================================"} . PHP\_EOL;

        \} \textcolor{keywordflow}{catch} (\(\backslash\)\hyperlink{classException}{Exception} $ex) \{
            \textcolor{keywordflow}{throw} $ex;
        \}
    \}
\}
\end{DoxyCodeInclude}
 